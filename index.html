<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Android Legacy Browser</title>
    <style>
        /* Holo Dark Theme Konstanten */
        :root {
            --holo-blue: #33b5e5;
            --bg-dark: #1a1a1a;
            --dialog-bg: #222222;
            --divider: #333333;
            --text-main: #ffffff;
            --text-sub: #888888;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #000;
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* HEADER & TABS */
        #browser-ui {
            background-color: var(--bg-dark);
            border-bottom: 2px solid #000;
            z-index: 10;
        }

        #tab-bar {
            display: flex;
            background-color: #000;
            overflow-x: auto;
            padding-top: 4px;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            max-width: 200px;
            padding: 8px 12px;
            background: #222;
            border: 1px solid #333;
            border-bottom: none;
            margin-right: 2px;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-sub);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tab.active {
            background: var(--bg-dark);
            color: var(--holo-blue);
            border-top: 3px solid var(--holo-blue);
        }

        .close-tab { margin-left: 8px; font-weight: bold; color: #666; }

        /* TOOLBAR / ADRESSLEISTE */
        #toolbar {
            display: flex;
            align-items: center;
            padding: 6px;
            gap: 6px;
            background: linear-gradient(to bottom, #333, #1a1a1a);
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 20px;
            padding: 5px;
            cursor: pointer;
        }

        #url-input {
            flex-grow: 1;
            background: #fff;
            color: #000;
            border: 1px solid var(--holo-blue);
            padding: 8px 10px;
            border-radius: 2px;
            font-size: 14px;
            outline: none;
        }

        /* VIEWPORT */
        #viewport-container {
            flex-grow: 1;
            position: relative;
            background: #fff;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ANDROID SYSTEM POPUP (EXAKT WIE IM BILD) */
        #popup-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none; /* Initial versteckt */
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #popup-window {
            background-color: var(--dialog-bg);
            width: 85%;
            max-width: 320px;
            border: 1px solid #444;
            box-shadow: 0 10px 30px rgba(0,0,0,1);
        }

        #popup-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid var(--holo-blue);
        }

        #popup-icon {
            width: 32px;
            height: 32px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="gray"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>') no-repeat center;
        }

        #popup-title {
            color: var(--holo-blue);
            font-size: 18px;
            font-weight: 500;
        }

        #popup-content {
            padding: 20px 15px;
            color: #ccc;
            font-size: 15px;
            line-height: 1.4;
        }

        #popup-footer {
            border-top: 1px solid #333;
            display: flex;
        }

        #popup-ok-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            text-transform: uppercase;
        }

        #popup-ok-btn:active { background-color: #333; }

    </style>
</head>
<body>

    <div id="browser-ui">
        <div id="tab-bar">
            </div>
        <div id="toolbar">
            <button class="nav-btn" onclick="browserBack()">◀</button>
            <button class="nav-btn" onclick="addTab()">✚</button>
            <input type="text" id="url-input" placeholder="Suchen oder URL eingeben" onkeydown="handleUrlInput(event)">
            <button class="nav-btn" onclick="showMenu()">⋮</button>
        </div>
    </div>

    <div id="viewport-container">
        <iframe id="main-frame" name="browser_frame"></iframe>

        <div id="popup-overlay">
            <div id="popup-window">
                <div id="popup-header">
                    <div id="popup-icon"></div>
                    <div id="popup-title">System Warning!</div>
                </div>
                <div id="popup-content">
                    Your phone is infected with viruses, and immediate action is required. Continue and follow the instructions to fix your phone. **Exit at your own risk**
                </div>
                <div id="popup-footer">
                    <button id="popup-ok-btn" onclick="closePopup()">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_OLD = "https://www.google.com/webhp?gbv=1";
        const SEARCH_URL = "https://www.google.com/search?gbv=1&q=";

        let tabs = [{ id: 1, title: "Google", url: GOOGLE_OLD }];
        let activeTabId = 1;

        // Initialisierung
        window.onload = () => {
            renderTabs();
            loadUrlInFrame(GOOGLE_OLD);
        };

        function renderTabs() {
            const container = document.getElementById('tab-bar');
            container.innerHTML = "";
            tabs.forEach(tab => {
                const tabEl = document.createElement('div');
                tabEl.className = `tab ${tab.id === activeTabId ? 'active' : ''}`;
                tabEl.innerHTML = `<span>${tab.title}</span><span class="close-tab" onclick="removeTab(${tab.id}, event)">×</span>`;
                tabEl.onclick = () => switchTab(tab.id);
                container.appendChild(tabEl);
            });
        }

        function handleUrlInput(e) {
            if (e.key === 'Enter') {
                let val = document.getElementById('url-input').value.trim();
                if (!val) return;

                let finalUrl = "";
                // Prüfung: Ist es eine URL oder ein Suchbegriff?
                const isUrl = val.includes('.') && !val.includes(' ');

                if (isUrl) {
                    finalUrl = val.startsWith('http') ? val : 'https://' + val;
                } else {
                    finalUrl = SEARCH_URL + encodeURIComponent(val);
                }

                updateCurrentTab(finalUrl, val);
            }
        }

        function updateCurrentTab(url, title) {
            const tab = tabs.find(t => t.id === activeTabId);
            tab.url = url;
            tab.title = title.substring(0, 15);
            loadUrlInFrame(url);
            renderTabs();
        }

        function loadUrlInFrame(url) {
            document.getElementById('main-frame').src = url;
            document.getElementById('url-input').value = (url === GOOGLE_OLD) ? "" : url;
        }

        function switchTab(id) {
            activeTabId = id;
            const tab = tabs.find(t => t.id === id);
            loadUrlInFrame(tab.url);
            renderTabs();
        }

        function addTab() {
            const newId = Date.now();
            tabs.push({ id: newId, title: "Neuer Tab", url: GOOGLE_OLD });
            switchTab(newId);
        }

        function removeTab(id, e) {
            e.stopPropagation();
            if (tabs.length === 1) return;
            tabs = tabs.filter(t => t.id !== id);
            if (activeTabId === id) activeTabId = tabs[0].id;
            switchTab(activeTabId);
        }

        function browserBack() {
            // Hinweis: In Iframes ist echte Navigation oft durch CORS gesperrt.
            window.history.back();
        }

        // POPUP LOGIK
        // Diese Funktion kannst du aufrufen, um das Android-Popup anzuzeigen
        function triggerSystemWarning() {
            document.getElementById('popup-overlay').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('popup-overlay').style.display = 'none';
        }

        // Simuliere das Abfangen: Zeige das Popup nach 3 Sekunden
        setTimeout(() => {
            triggerSystemWarning();
        }, 3000);

    </script>
</body>
</html>
